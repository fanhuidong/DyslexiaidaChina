# 短信宝配置指南

本文档说明如何配置短信宝服务以支持登录、注册、修改密码和找回密码功能。

## 环境变量配置

在 `.env.local` 文件中添加以下配置：

```env
# 短信宝配置
SMS_BAO_USERNAME=你的短信宝用户名
SMS_BAO_PASSWORD=你的短信宝密码（MD5加密后的密码）
SMS_BAO_API_URL=http://api.smsbao.com/sms
```

## 获取短信宝账号

1. 访问 [短信宝官网](http://www.smsbao.com/)
2. 注册账号并登录
3. 在控制台获取用户名和密码
4. 将密码进行 MD5 加密（短信宝要求使用 MD5 加密后的密码）

## MD5 加密密码

可以使用以下方式获取 MD5 加密后的密码：

### Node.js 方式

```javascript
const crypto = require('crypto');
const password = '你的原始密码';
const md5Password = crypto.createHash('md5').update(password).digest('hex');
console.log(md5Password);
```

### 在线工具

访问 MD5 在线加密工具，输入密码后获取 MD5 值。

## 功能说明

### 1. 注册功能
- 用户输入手机号、用户名、密码和验证码
- 系统发送注册验证码到用户手机
- 验证码有效期为 5 分钟
- 验证码只能使用一次

### 2. 登录功能
- **密码登录**：使用手机号和密码登录
- **手机登录**：使用手机号和短信验证码登录
- 验证码有效期为 5 分钟

### 3. 找回密码
- 用户输入手机号
- 系统发送密码重置验证码
- 用户输入验证码和新密码完成重置

### 4. 修改密码
- 需要用户已登录
- 系统发送修改密码验证码
- 用户输入验证码和新密码完成修改

## 开发模式

在开发环境中（`NODE_ENV=development`），如果未配置短信宝或发送失败，系统会：
- 在控制台输出验证码（方便测试）
- 返回成功响应（不会阻塞开发流程）

## 验证码规则

- 验证码为 6 位数字
- 有效期为 5 分钟
- 每个手机号每种类型每分钟只能发送一次
- 验证码使用后立即删除（一次性使用）

## 验证码类型

- `register` - 注册验证码
- `login` - 登录验证码
- `reset-password` - 找回密码验证码
- `change-password` - 修改密码验证码

## 短信内容模板

系统会根据验证码类型自动生成短信内容：

- 注册：`【阅读障碍】您的注册验证码是{code}，5分钟内有效。`
- 登录：`【阅读障碍】您的登录验证码是{code}，5分钟内有效。`
- 找回密码：`【阅读障碍】您的密码重置验证码是{code}，5分钟内有效。`
- 修改密码：`【阅读障碍】您的修改密码验证码是{code}，5分钟内有效。`

## 错误处理

短信宝返回的错误码：

- `0` - 发送成功
- `-1` - 账号不存在
- `-2` - 接口密钥不正确
- `-21` - MD5接口密钥加密不正确
- `-3` - 短信数量不足
- `-11` - 该用户被禁用
- `-14` - 短信内容出现非法字符
- `-41` - 手机号码为空
- `-42` - 手机号码格式不正确
- `-51` - 短信签名格式不正确
- `-6` - IP限制

## 测试建议

1. 在开发环境中测试时，验证码会输出到控制台
2. 确保手机号格式正确（11位，以1开头）
3. 注意验证码的有效期和发送频率限制
4. 生产环境部署前，确保短信宝账号有足够的余额

## 注意事项

1. **密码安全**：短信宝密码必须使用 MD5 加密，不要直接使用明文密码
2. **短信签名**：短信内容中的 `【阅读障碍】` 是短信签名，需要根据实际需求修改
3. **频率限制**：系统已实现 1 分钟内只能发送一次验证码的限制
4. **验证码存储**：验证码存储在数据库中，5 分钟后自动过期
5. **一次性使用**：验证码验证成功后立即删除，不能重复使用
