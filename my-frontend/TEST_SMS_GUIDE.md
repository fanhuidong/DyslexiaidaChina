# 本地测试短信验证码功能指南

## 测试前准备

### 1. 确保数据库连接正常

确保 `.env.local` 文件中配置了数据库连接：

```env
DATABASE_URL=mysql://用户名:密码@localhost:3306/数据库名
```

### 2. 开发模式说明

在开发环境中（`NODE_ENV=development`），系统会自动：
- 如果未配置短信宝，验证码会输出到**服务器控制台**
- 验证码也会在 API 响应中返回（仅开发环境）
- 不会真正发送短信，方便本地测试

## 测试步骤

### 步骤 1：启动开发服务器

```bash
cd my-frontend
npm run dev
```

服务器启动后，你会看到类似输出：
```
  ▲ Next.js 16.1.1
  - Local:        http://localhost:3000
```

### 步骤 2：打开浏览器

访问以下页面进行测试：

#### 测试注册功能
- 访问：http://localhost:3000/register
- 输入手机号（11位，以1开头，如：13800138000）
- 点击"发送验证码"按钮
- **查看服务器控制台**，你会看到类似输出：
  ```
  📱 [开发模式] 验证码：123456，手机号：13800138000，类型：register
  ```
- 在表单中输入验证码完成注册

#### 测试手机登录功能
- 访问：http://localhost:3000/login
- 切换到"手机登录"标签
- 输入手机号
- 点击"发送验证码"按钮
- **查看服务器控制台**获取验证码
- 输入验证码完成登录

#### 测试找回密码功能
- 访问：http://localhost:3000/forgot-password
- 输入已注册的手机号
- 点击"发送验证码"按钮
- **查看服务器控制台**获取验证码
- 输入验证码和新密码完成重置

#### 测试修改密码功能
- 先登录账号
- 访问：http://localhost:3000/change-password
- 点击"发送验证码"按钮
- **查看服务器控制台**获取验证码
- 输入验证码和新密码完成修改

## 查看验证码的位置

### 方法 1：服务器控制台（推荐）
在运行 `npm run dev` 的终端窗口中查看，验证码会以以下格式输出：
```
📱 [开发模式] 验证码：123456，手机号：13800138000，类型：register
```

### 方法 2：浏览器控制台（仅部分场景）
在注册和登录表单中，如果 API 返回了验证码，也会在浏览器控制台输出：
```
📱 验证码: 123456
```

### 方法 3：API 响应（开发环境）
在开发环境中，API 响应中会包含验证码字段：
```json
{
  "success": true,
  "message": "验证码发送成功",
  "code": "123456"
}
```

## 测试要点

### ✅ 验证码格式
- 验证码是 6 位数字
- 有效期为 5 分钟
- 验证后立即删除（一次性使用）

### ✅ 发送频率限制
- 每个手机号每种类型每分钟只能发送一次
- 如果频繁发送，会提示："验证码发送过于频繁，请1分钟后再试"

### ✅ 手机号验证
- 必须是 11 位数字
- 必须以 1 开头
- 格式：`1[3-9]xxxxxxxxx`

### ✅ 验证码类型
- `register` - 注册验证码（手机号必须未注册）
- `login` - 登录验证码（手机号必须已注册）
- `reset-password` - 找回密码验证码（手机号必须已注册）
- `change-password` - 修改密码验证码（需要登录）

## 常见问题

### Q: 验证码在哪里查看？
A: 在运行 `npm run dev` 的**服务器终端窗口**中查看，不是浏览器控制台。

### Q: 为什么看不到验证码？
A: 
1. 检查服务器是否正常运行
2. 检查终端窗口是否显示错误信息
3. 确认是在开发模式（`NODE_ENV=development`）

### Q: 验证码发送失败？
A: 
1. 检查手机号格式是否正确（11位，以1开头）
2. 检查是否在1分钟内重复发送
3. 检查数据库连接是否正常
4. 查看服务器控制台的错误信息

### Q: 如何测试真实的短信发送？
A: 在 `.env.local` 中配置短信宝账号：
```env
SMS_BAO_USERNAME=你的用户名
SMS_BAO_PASSWORD=MD5加密后的密码
```

## 测试检查清单

- [ ] 开发服务器已启动
- [ ] 数据库连接正常
- [ ] 可以访问注册页面
- [ ] 可以发送注册验证码
- [ ] 可以在服务器控制台看到验证码
- [ ] 可以使用验证码完成注册
- [ ] 可以测试手机登录
- [ ] 可以测试找回密码
- [ ] 可以测试修改密码（需要先登录）
